<ion-header translucent="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/lista"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalle del producto</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ng-container *ngIf="product$ | async as product; else notFound">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ product.name }}</ion-card-title>
        <ion-card-subtitle>{{ product.category }} · {{ product.quantity }} {{ product.unit }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-icon name="time-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Fecha de consumo óptimo</h3>
              <p>{{ product.expiry }} · {{ daysUntil(product.expiry) }} día(s) restantes</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-icon name="leaf-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Eco-score</h3>
              <p>{{ product.ecoScore }} / 100</p>
            </ion-label>
          </ion-item>

          <ion-item *ngIf="product.notes">
            <ion-icon name="book-outline" slot="start"></ion-icon>
            <ion-label>
              <h3>Notas</h3>
              <p>{{ product.notes }}</p>
            </ion-label>
          </ion-item>
        </ion-list>

        <div class="actions">
          <ion-button expand="block" color="success" (click)="togglePurchased(product)">
            <ion-icon name="checkmark-circle" slot="start"></ion-icon>
            {{ product.purchased ? 'Marcar como pendiente' : 'Producto comprado' }}
          </ion-button>
          <ion-button expand="block" fill="outline" color="tertiary" (click)="remindLater(product)">
            <ion-icon name="notifications-outline" slot="start"></ion-icon>
            Recordarme más tarde
          </ion-button>
          <ion-button expand="block" fill="clear" color="medium" routerLink="/perfil">
            <ion-icon name="person-circle-outline" slot="start"></ion-icon>
            Ir a perfil
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card class="suggestions-card">
      <ion-card-header>
        <ion-card-title>Prioriza estos alimentos</ion-card-title>
        <ion-card-subtitle>
          Otras recomendaciones de consumo responsable.
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <ion-list lines="none" *ngIf="suggestions$ | async as suggestions">
          <ion-item *ngFor="let suggestion of suggestions">
            <ion-icon name="flash-outline" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>{{ suggestion.name }}</h3>
              <p>Vence en {{ daysUntil(suggestion.expiry) }} día(s)</p>
            </ion-label>
            <ion-button size="small" fill="clear" [routerLink]="['/detalle', suggestion.id]">
              Ver
            </ion-button>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </ng-container>

  <ng-template #notFound>
    <div class="empty-state">
      <ion-icon name="alert-circle-outline"></ion-icon>
      <h2>No encontramos el producto</h2>
      <p>Revisa tu EcoLista para seleccionar otro alimento.</p>
      <ion-button routerLink="/lista" color="success">Ir a la EcoLista</ion-button>
    </div>
  </ng-template>
</ion-content>
